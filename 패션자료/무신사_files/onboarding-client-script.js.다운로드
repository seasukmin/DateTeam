var $onboarding=function(o){"use strict";var A=Object.defineProperty;var E=(o,a,l)=>a in o?A(o,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):o[a]=l;var r=(o,a,l)=>(E(o,typeof a!="symbol"?a+"":a,l),l);const a=(e,t)=>typeof window<"u"?window.localStorage.setItem(e,t):void 0,l=e=>typeof window<"u"?window.localStorage.getItem(e)??null:null,m=e=>typeof window<"u"?window.localStorage.removeItem(e):void 0;class w{constructor(t){r(this,"storageKey");this.storageKey=t}get(){const t=l(this.storageKey);return t?JSON.parse(t):null}set(t){a(this.storageKey,JSON.stringify(t))}remove(){m(this.storageKey)}}const v={name:"@musinsa/onboarding-client-script",version:"0.2.2",type:"module",main:"./src/index.ts",publishConfig:{types:"./dist/index.d.js",typings:"dist/index.d.ts",main:"./dist/onboarding-client-script.umd.js",module:"./dist/onboarding-client-script.js",exports:{".":{import:"./dist/onboarding-client-script.js",require:"./dist/onboarding-client-script.umd.js"}}},scripts:{dev:"vite dev",build:"vite build","build:analyze":"ANALYZE=true vite build","build:watch":"vite build --watch",preview:"vite preview",vitest:"vitest"},dependencies:{preact:"^10.19.3",react:"npm:@preact/compat@latest","react-dom":"npm:@preact/compat@latest"},devDependencies:{"@babel/plugin-transform-react-jsx":"^7.19.0","@medusa/browser-util":"workspace:^","@musinsa/community-shared-ts":"workspace:^","@rollup/plugin-alias":"^5.1.0","@types/node":"18.17.6","@types/react":"18.2.20","@types/react-dom":"18.2.7","@vitejs/plugin-react":"^4.0.0","eslint-config-musinsaCommunity":"workspace:^","happy-dom":"^13.0.2",msw:"^2.0.14",postcss:"^8.4.28",prettier:"3.0.3","rollup-plugin-visualizer":"^5.12.0",rome:"^12.1.3",typescript:"^5.2.2",vite:"^4.3.9","vite-plugin-dts":"^3.7.0",vitest:"^1.5.2"}},g=()=>typeof window>"u",h=()=>g()?"prd":window.location.host.includes("dev")?"dev":window.location.host.includes("alpha")?"alp":"prd",p=()=>{const e=h();return e==="prd"?"":e},b=(e=new Date)=>new Date(e.getTime()-e.getTimezoneOffset()*6e4).toISOString();function S(e){const t={};return e.split(";").forEach(function(i){var u;const n=i.split("="),c=(u=n.shift())==null?void 0:u.trim(),d=n.join("=").trim();c&&(t[c]=d)}),t}const _=e=>{if(e===void 0)return null;try{const t=e.split(".")[1];return JSON.parse(typeof atob=="function"?atob(t):Buffer.from(e.split(".")[1],"base64").toString("utf-8"))}catch{return null}},k=()=>{var e;return g()?null:_((e=S(document.cookie))==null?void 0:e.mss_mac)};class y{constructor(t){r(this,"name","base");r(this,"version",v.version);r(this,"shortHashId");r(this,"storageKey");r(this,"storage");const s=k(),{hashId:i=t==null?void 0:t.hashId}=s??{};if(i){this.shortHashId=i.slice(0,8),this.storageKey=this.getStorageKey(t==null?void 0:t.name),this.storage=new w(this.storageKey);const n=this.dataGet("_version");(!n||n!==this.version)&&this.storage.remove(),this.dataSet("_version",this.version),this.dataGet("_created")||this.dataSet("_created",new Date().getTime()),this.dataGet("_hashId")||this.dataSet("_hashId",i)}}dataGet(t){var i;return(((i=this.storage)==null?void 0:i.get())??{})[t]}dataSet(t,s){var n,c;const i=((n=this.storage)==null?void 0:n.get())??{};i[t]=s,(c=this.storage)==null||c.set({...i})}getStorageKey(t){const s=p()?`-${p()}`:"";return`mss.onboarding.${t??this.name}-${this.shortHashId}${s}`}getCurrentPageKey(){return window._ga_pageid||window.location.pathname}clear(){}}r(y,"serviceEnv",h());class H extends y{constructor(...s){super({...s[0],name:"visit-checker"});r(this,"MAX_HISTORY_SIZE",50);r(this,"proxySet",!1)}getLastVisitHistory(){const s=this.dataGet("lastVisitHistory");return new Map(s)}updateLastVisitHistory(){const s=this.getLastVisitHistory();if(s.has(this.getCurrentPageKey()))s.delete(this.getCurrentPageKey());else if(s.size>=this.MAX_HISTORY_SIZE){const i=s.keys().next().value;s.delete(i)}s.set(this.getCurrentPageKey(),{_updated:new Date().getTime()}),this.dataSet("lastVisitHistory",[...s.entries()])}init(){typeof Proxy=="function"&&!this.proxySet&&(window.history.pushState=new Proxy(window.history.pushState,{apply:(s,i,n)=>(this.updateLastVisitHistory(),s.apply(i,n))}),this.proxySet=!0),this.updateLastVisitHistory()}}class I extends y{constructor(...t){super({...t[0],name:"event-checker"})}sliceHistory(t,s){return[s,...t].slice(-10)}getTrackEvent(){const t=this.dataGet("trackEvent");return new Map(t)}track(t,s){const i=this.getTrackEvent(),n=i.get(t),c=(n==null?void 0:n._history)??[],d={_updated:new Date().getTime(),key:this.getCurrentPageKey(),data:s};i.set(t,{...d,_history:this.sliceHistory(c,d)}),h()!=="prd"&&(console.log("@@@ event-checker - track",[...i.entries()]),this.shortHashId||console.warn("@@@ event-checker - shortHashId",this.shortHashId)),this.dataSet("trackEvent",[...i.entries()])}}const f=()=>p()?`${p()}.`:"",V=Object.freeze(Object.defineProperty({__proto__:null,fetchMy:async(e,t)=>{const i=`https://my.${f()}musinsa.com`,n=new URL(i);return n.pathname=e,t&&Object.entries(t).forEach(([d,u])=>{n.searchParams.append(d,`${u}`)}),await(await fetch(n.href)).json()},fetchOnboarding:async(e,t)=>{const i=`https://onboarding.${f()}musinsa.com`,n=new URL(i);return n.pathname=e,t&&Object.entries(t).forEach(([d,u])=>{n.searchParams.append(d,`${u}`)}),await(await fetch(n.href)).json()},getSubdomain:f},Symbol.toStringTag,{value:"Module"})),j=Object.freeze(Object.defineProperty({__proto__:null,requestAmplitudeVariant:e=>{var t;typeof window<"u"&&((t=window==null?void 0:window.AppInterface)!=null&&t.requestAmplitudeVariant?window.AppInterface.requestAmplitudeVariant(e):console.log("onboarding:: requestAmplitudeVariant is not available"))},sendAmplitudeVariantNative:e=>{if(typeof window<"u"){const t=s=>{s.detail&&s.detail.key&&s.detail.value?s.detail.key===e.key&&e.fn(s.detail):console.log("onboarding:: sendAmplitudeVariant can't work")};window.addEventListener("sendAmplitudeVariant",t)}}},Symbol.toStringTag,{value:"Module"})),O=Object.freeze(Object.defineProperty({__proto__:null,getKrDate:b,getServiceEnv:h,getSubEnvWithServiceEnv:p,isServer:g},Symbol.toStringTag,{value:"Module"}));return o.EventChecker=I,o.VisitChecker=H,o.apiClient=V,o.experiment=j,o.utils=O,Object.defineProperty(o,Symbol.toStringTag,{value:"Module"}),o}({});
